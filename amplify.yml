version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        - |
          cat > next.config.js << 'EOF'
          const nextConfig = {
            output: 'export',
            trailingSlash: true,
            distDir: 'out',
            images: {
              unoptimized: true,
              remotePatterns: [
                {
                  protocol: 'https',
                  hostname: '**',
                },
              ],
            },
            eslint: {
              ignoreDuringBuilds: true,
            },
          };
          module.exports = nextConfig;
          EOF
        - npm run build
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - .next/cache/**/*
      - .npm/**/*